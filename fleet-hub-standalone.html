<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fleet Management Hub</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: system-ui, sans-serif; background: #0f172a; color: #e2e8f0; min-height: 100vh; padding: 1rem; }
    .app { display: flex; min-height: 100vh; gap: 1rem; }
    .sidebar { width: 200px; background: #1e293b; border: 1px solid #334155; border-radius: 0.5rem; padding: 1rem; flex-shrink: 0; }
    .main { flex: 1; padding: 1.5rem; background: #1e293b; border: 1px solid #334155; border-radius: 0.5rem; overflow: auto; }
    .nav-link { display: block; padding: 0.5rem 0.75rem; color: #94a3b8; text-decoration: none; border-radius: 0.5rem; margin-bottom: 0.25rem; cursor: pointer; }
    .nav-link:hover, .nav-link.active { background: rgba(14, 165, 233, 0.2); color: #38bdf8; }
    .login-box { max-width: 360px; margin: 4rem auto; padding: 2rem; background: #1e293b; border: 1px solid #334155; border-radius: 0.75rem; }
    .login-box h1 { text-align: center; color: #38bdf8; margin-bottom: 0.5rem; font-size: 1.5rem; }
    .form-group { margin-bottom: 1rem; }
    .form-group label { display: block; font-size: 0.875rem; color: #94a3b8; margin-bottom: 0.25rem; }
    input, select, button { width: 100%; padding: 0.5rem 0.75rem; border-radius: 0.5rem; border: 1px solid #475569; background: #334155; color: #f1f5f9; font-size: 1rem; }
    button { cursor: pointer; border: none; background: #0284c7; color: white; font-weight: 500; }
    button:hover { background: #0ea5e9; }
    .btn-sm { padding: 0.35rem 0.75rem; width: auto; font-size: 0.875rem; }
    .btn-secondary { background: #475569; }
    .card { background: #0f172a; border: 1px solid #334155; border-radius: 0.5rem; padding: 1rem; margin-bottom: 1rem; }
    .kpi-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 1rem; margin-bottom: 1.5rem; }
    .kpi-card { background: #1e293b; border: 1px solid #334155; border-radius: 0.5rem; padding: 1rem; }
    .kpi-card .value { font-size: 1.5rem; font-weight: 700; color: #38bdf8; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 0.75rem; text-align: left; border-bottom: 1px solid #334155; }
    th { color: #94a3b8; font-size: 0.875rem; }
    .pill { display: inline-block; padding: 0.2rem 0.5rem; border-radius: 9999px; font-size: 0.75rem; }
    .pill-available { background: rgba(16, 185, 129, 0.2); color: #34d399; }
    .pill-on-trip { background: rgba(245, 158, 11, 0.2); color: #fbbf24; }
    .pill-in-shop { background: rgba(249, 115, 22, 0.2); color: #fb923c; }
    .pill-out { background: rgba(100, 116, 139, 0.2); color: #94a3b8; }
    .pill-draft, .pill-dispatched, .pill-completed, .pill-pending { background: rgba(100, 116, 139, 0.2); color: #94a3b8; }
    .pill-completed { background: rgba(16, 185, 129, 0.2); color: #34d399; }
    .hidden { display: none !important; }
    .form-inline { display: flex; flex-wrap: wrap; gap: 0.75rem; align-items: flex-end; }
    .form-inline .form-group { flex: 1; min-width: 120px; }
    .error { color: #f87171; font-size: 0.875rem; margin-top: 0.5rem; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script>
    (function() {
      var STORAGE = { user: 'fleet_user', vehicles: 'fleet_vehicles', drivers: 'fleet_drivers', trips: 'fleet_trips', cargo: 'fleet_cargo', fuel: 'fleet_fuel', maintenance: 'fleet_maintenance' };
      
      function load(key) {
        try {
          var v = localStorage.getItem(STORAGE[key]);
          return v ? JSON.parse(v) : [];
        } catch (e) { return []; }
      }
      
      function save(key, val) {
        try {
          localStorage.setItem(STORAGE[key], JSON.stringify(val));
        } catch (e) { alert('Storage error: ' + e.message); }
      }

      function initData() {
        var v = load('vehicles');
        if (!v || v.length === 0) {
          save('vehicles', [
            { id: 1, name: 'Van-01', model: 'Ford Transit', license_plate: 'ABC-1234', type: 'Van', max_capacity_kg: 500, odometer: 0, status: 'available', region: 'North' },
            { id: 2, name: 'Van-02', model: 'Mercedes Sprinter', license_plate: 'DEF-5678', type: 'Van', max_capacity_kg: 750, odometer: 0, status: 'available', region: 'South' },
            { id: 3, name: 'Truck-01', model: 'Isuzu NPR', license_plate: 'GHI-9012', type: 'Truck', max_capacity_kg: 3000, odometer: 0, status: 'available', region: 'North' }
          ]);
          save('drivers', [
            { id: 1, name: 'Alex Johnson', license_expiry: '2026-12-31', status: 'on_duty', safety_score: 95, trip_completion_rate: 98 },
            { id: 2, name: 'Maria Garcia', license_expiry: '2026-06-15', status: 'off_duty', safety_score: 92, trip_completion_rate: 96 }
          ]);
          save('cargo', [
            { id: 1, description: 'Electronics', weight_kg: 450, status: 'pending' },
            { id: 2, description: 'Office supplies', weight_kg: 120, status: 'pending' }
          ]);
        }
      }
      initData();

      function nextId(arr) { return Math.max(0, Math.max.apply(null, (arr || []).map(function(x) { return x.id || 0; }))) + 1; }

      function pill(s) {
        var m = { available: 'pill-available', on_trip: 'pill-on-trip', in_shop: 'pill-in-shop', out_of_service: 'pill-out', draft: 'pill-draft', dispatched: 'pill-dispatched', completed: 'pill-completed', pending: 'pill-pending' };
        return 'pill ' + (m[s] || 'pill-out');
      }

      function renderLogin() {
        var root = document.getElementById('root');
        root.innerHTML = '<div class="login-box">' +
          '<h1>Fleet Management Hub</h1>' +
          '<p style="text-align:center;color:#64748b;margin-bottom:1rem">No npm or Node.js needed. Works offline.</p>' +
          '<form id="loginForm">' +
          '<div class="form-group"><label>Email</label><input type="email" name="email" placeholder="ENTER EMAIL ADDRESS" required></div>' +
          '<div class="form-group"><label>Password</label><input type="password" name="pass" placeholder="password" required></div>' +
          '<div id="loginError" class="error hidden"></div>' +
          '<button type="submit" style="margin-top:0.5rem">Sign In</button>' +
          '</form>' +
          '<p style="text-align:center;margin-top:1rem;font-size:0.75rem;color:#64748b">Demo: manager@fleet.com / fleet123</p>' +
          '</div>';
        document.getElementById('loginForm').onsubmit = function(e) {
          e.preventDefault();
          var em = this.email.value.trim();
          var pw = this.pass.value;
          var errEl = document.getElementById('loginError');
          if (em === 'owner@fleet.com' && pw === 'owner@1') {
            save('user', { email: em, role: 'manager', name: 'Manager' });
            renderApp();
          } else {
            errEl.textContent = 'Invalid credentials';
            errEl.classList.remove('hidden');
          }
        };
      }

      function renderMain(page) {
        var main = document.getElementById('main');
        if (!main) return;
        main.innerHTML = '';

        if (page === 'dashboard') {
          var vehicles = load('vehicles');
          var cargo = load('cargo');
          var onTrip = vehicles.filter(function(v) { return v.status === 'on_trip'; }).length;
          var inShop = vehicles.filter(function(v) { return v.status === 'in_shop'; }).length;
          var total = vehicles.filter(function(v) { return v.status !== 'out_of_service'; }).length;
          var assigned = vehicles.filter(function(v) { return v.status === 'on_trip' || v.status === 'in_shop'; }).length;
          var util = total > 0 ? Math.round(100 * assigned / total) : 0;
          var pend = cargo.filter(function(c) { return c.status === 'pending'; }).length;
          
          main.innerHTML = '<h2 style="margin-bottom:0.25rem">Command Center</h2>' +
            '<p style="color:#94a3b8;margin-bottom:1rem">Fleet oversight at a glance</p>' +
            '<div class="kpi-grid">' +
            '<div class="kpi-card"><div style="font-size:0.75rem;color:#64748b">Active Fleet</div><div class="value">' + onTrip + '</div><div style="font-size:0.75rem;color:#64748b">On Trip</div></div>' +
            '<div class="kpi-card"><div style="font-size:0.75rem;color:#64748b">Maintenance Alerts</div><div class="value">' + inShop + '</div><div style="font-size:0.75rem;color:#64748b">In Shop</div></div>' +
            '<div class="kpi-card"><div style="font-size:0.75rem;color:#64748b">Utilization Rate</div><div class="value">' + util + '%</div><div style="font-size:0.75rem;color:#64748b">Assigned vs Idle</div></div>' +
            '<div class="kpi-card"><div style="font-size:0.75rem;color:#64748b">Pending Cargo</div><div class="value">' + pend + '</div><div style="font-size:0.75rem;color:#64748b">Awaiting</div></div>' +
            '</div>' +
            '<div class="card"><table><thead><tr><th>Name</th><th>Type</th><th>License</th><th>Status</th><th>Region</th></tr></thead><tbody id="dashTbody"></tbody></table></div>';
          var tbody = document.getElementById('dashTbody');
          vehicles.filter(function(v) { return v.status !== 'out_of_service'; }).forEach(function(v) {
            tbody.innerHTML += '<tr><td>' + v.name + '</td><td>' + v.type + '</td><td>' + v.license_plate + '</td><td><span class="' + pill(v.status) + '">' + v.status.replace('_', ' ') + '</span></td><td>' + (v.region || '-') + '</td></tr>';
          });
        } else if (page === 'vehicles') {
          var vehicles = load('vehicles');
          main.innerHTML = '<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;flex-wrap:wrap">' +
            '<h2>Vehicle Registry</h2>' +
            '<button type="button" class="btn-sm" id="toggleVehicleForm">Add Vehicle</button>' +
            '</div><p style="color:#94a3b8;margin-bottom:1rem">CRUD for physical assets</p>' +
            '<div id="vForm" class="card hidden">' +
            '<form id="vehicleForm"><div class="form-inline">' +
            '<div class="form-group"><label>Name</label><input name="name" required></div>' +
            '<div class="form-group"><label>Model</label><input name="model"></div>' +
            '<div class="form-group"><label>License</label><input name="license_plate" required></div>' +
            '<div class="form-group"><label>Type</label><select name="type"><option>Van</option><option>Truck</option><option>Bike</option></select></div>' +
            '<div class="form-group"><label>Max Capacity (kg)</label><input name="cap" type="number" required></div>' +
            '<div class="form-group"><label>Region</label><input name="region"></div>' +
            '<button type="submit" class="btn-sm">Create</button></div></form></div>' +
            '<div class="card"><table><thead><tr><th>Name</th><th>License</th><th>Capacity</th><th>Odometer</th><th>Status</th><th>Actions</th></tr></thead><tbody id="vehicleTbody"></tbody></table></div>';
          document.getElementById('toggleVehicleForm').onclick = function() {
            document.getElementById('vForm').classList.toggle('hidden');
          };
          document.getElementById('vehicleForm').onsubmit = function(e) {
            e.preventDefault();
            var d = this;
            var vehicles = load('vehicles');
            if (vehicles.some(function(x) { return x.license_plate === d.license_plate.value; })) {
              alert('License plate already exists');
              return;
            }
            vehicles.push({ id: nextId(vehicles), name: d.name.value, model: d.model.value, license_plate: d.license_plate.value, type: d.type.value, max_capacity_kg: parseInt(d.cap.value, 10), region: d.region.value, odometer: 0, status: 'available' });
            save('vehicles', vehicles);
            document.getElementById('vForm').classList.add('hidden');
            this.reset();
            renderMain('vehicles');
          };
          var tbody = document.getElementById('vehicleTbody');
          vehicles.forEach(function(v) {
            tbody.innerHTML += '<tr><td>' + v.name + (v.model ? ' ' + v.model : '') + '</td><td>' + v.license_plate + '</td><td>' + v.max_capacity_kg + ' kg</td><td>' + (v.odometer || 0) + ' km</td><td><span class="' + pill(v.status) + '">' + v.status.replace('_', ' ') + '</span></td><td><button type="button" class="btn-sm btn-secondary" data-id="' + v.id + '" data-action="toggle">' + (v.status === 'out_of_service' ? 'Restore' : 'Out of Service') + '</button></td></tr>';
          });
          tbody.querySelectorAll('[data-action="toggle"]').forEach(function(btn) {
            var vid = parseInt(btn.dataset.id, 10);
            btn.onclick = function() {
              var vehicles = load('vehicles');
              var v = vehicles.find(function(x) { return x.id === vid; });
              if (v) { v.status = v.status === 'out_of_service' ? 'available' : 'out_of_service'; save('vehicles', vehicles); renderMain('vehicles'); }
            };
          });
        } else if (page === 'trips') {
          var vehicles = load('vehicles');
          var drivers = load('drivers');
          var trips = load('trips');
          var availV = vehicles.filter(function(v) { return v.status === 'available'; });
          var availD = drivers.filter(function(d) { return d.status === 'on_duty' && (!d.license_expiry || new Date(d.license_expiry) > new Date()); });
          
          main.innerHTML = '<h2 style="margin-bottom:0.25rem">Trip Dispatcher</h2><p style="color:#94a3b8;margin-bottom:1rem">Create trips. Cargo weight cannot exceed vehicle capacity.</p>' +
            '<form id="tripForm" class="card"><div class="form-inline">' +
            '<div class="form-group"><label>Vehicle</label><select name="vehicle_id" required><option value="">Select</option>' + availV.map(function(v) { return '<option value="' + v.id + '">' + v.name + ' (' + v.max_capacity_kg + 'kg)</option>'; }).join('') + '</select></div>' +
            '<div class="form-group"><label>Driver</label><select name="driver_id" required><option value="">Select</option>' + availD.map(function(d) { return '<option value="' + d.id + '">' + d.name + '</option>'; }).join('') + '</select></div>' +
            '<div class="form-group"><label>Cargo (kg)</label><input name="cargo_weight" type="number" required></div>' +
            '<div class="form-group"><label>Origin</label><input name="origin"></div><div class="form-group"><label>Destination</label><input name="dest"></div>' +
            '<button type="submit" class="btn-sm">Create Trip</button></div></form>' +
            '<div class="card"><table><thead><tr><th>ID</th><th>Vehicle</th><th>Driver</th><th>Cargo</th><th>Route</th><th>Status</th><th>Actions</th></tr></thead><tbody id="tripTbody"></tbody></table></div>';
          
          document.getElementById('tripForm').onsubmit = function(e) {
            e.preventDefault();
            var d = this;
            var vehicles = load('vehicles');
            var drivers = load('drivers');
            var trips = load('trips');
            var v = vehicles.find(function(x) { return x.id === parseInt(d.vehicle_id.value, 10); });
            var dr = drivers.find(function(x) { return x.id === parseInt(d.driver_id.value, 10); });
            var cw = parseInt(d.cargo_weight.value, 10);
            if (!v || !dr) { alert('Select vehicle and driver'); return; }
            if (cw > v.max_capacity_kg) { alert('Cargo exceeds vehicle capacity!'); return; }
            trips.push({ id: nextId(trips), vehicle_id: v.id, driver_id: dr.id, vehicle_name: v.name, driver_name: dr.name, cargo_weight_kg: cw, origin: d.origin.value, destination: d.dest.value, status: 'draft' });
            save('trips', trips);
            this.reset();
            renderMain('trips');
          };
          var tbody = document.getElementById('tripTbody');
          trips.forEach(function(t) {
            var act = '';
            if (t.status === 'draft') act += '<button type="button" class="btn-sm" data-action="dispatch" data-id="' + t.id + '">Dispatch</button> ';
            if (t.status === 'dispatched') act += '<button type="button" class="btn-sm" data-action="complete" data-id="' + t.id + '">Complete</button> ';
            if (t.status === 'draft' || t.status === 'dispatched') act += '<button type="button" class="btn-sm btn-secondary" data-action="cancel" data-id="' + t.id + '">Cancel</button>';
            tbody.innerHTML += '<tr><td>#' + t.id + '</td><td>' + t.vehicle_name + '</td><td>' + t.driver_name + '</td><td>' + t.cargo_weight_kg + ' kg</td><td>' + (t.origin || '-') + ' â†’ ' + (t.destination || '-') + '</td><td><span class="' + pill(t.status) + '">' + t.status + '</span></td><td>' + act + '</td></tr>';
          });
          tbody.querySelectorAll('[data-action]').forEach(function(btn) {
            var tid = parseInt(btn.dataset.id, 10);
            var action = btn.dataset.action;
            btn.onclick = function() {
              var vehicles = load('vehicles');
              var drivers = load('drivers');
              var trips = load('trips');
              var t = trips.find(function(x) { return x.id === tid; });
              if (!t) return;
              var v = vehicles.find(function(x) { return x.id === t.vehicle_id; });
              var d = drivers.find(function(x) { return x.id === t.driver_id; });
              if (action === 'dispatch') { if (v) v.status = 'on_trip'; if (d) d.status = 'on_trip'; t.status = 'dispatched'; }
              if (action === 'complete' || action === 'cancel') { if (v) v.status = 'available'; if (d) d.status = 'on_duty'; t.status = action === 'complete' ? 'completed' : 'cancelled'; }
              save('vehicles', vehicles); save('drivers', drivers); save('trips', trips);
              renderMain('trips');
            };
          });
        } else if (page === 'drivers') {
          var drivers = load('drivers');
          main.innerHTML = '<h2 style="margin-bottom:0.25rem">Driver Profiles</h2><p style="color:#94a3b8;margin-bottom:1rem">License expiry, safety score, status</p>' +
            '<div class="card"><table><thead><tr><th>Name</th><th>License Expiry</th><th>Status</th><th>Safety</th><th>Completion %</th></tr></thead><tbody id="driverTbody"></tbody></table></div>';
          var tbody = document.getElementById('driverTbody');
          drivers.forEach(function(d) {
            var exp = d.license_expiry ? (new Date(d.license_expiry) < new Date() ? '<span style="color:#f87171">' + d.license_expiry + ' (Expired)</span>' : d.license_expiry) : '-';
            tbody.innerHTML += '<tr><td>' + d.name + '</td><td>' + exp + '</td><td><span class="' + pill(d.status) + '">' + d.status.replace('_', ' ') + '</span></td><td>' + d.safety_score + '%</td><td>' + d.trip_completion_rate + '%</td></tr>';
          });
        } else if (page === 'maintenance') {
          var vehicles = load('vehicles');
          var maintenanceLogs = load('maintenance');
          var avail = vehicles.filter(function(v) { return v.status !== 'in_shop' && v.status !== 'on_trip' && v.status !== 'out_of_service'; });
          main.innerHTML = '<h2 style="margin-bottom:0.25rem">Maintenance Logs</h2><p style="color:#94a3b8;margin-bottom:1rem">Adding service sets vehicle to In Shop</p>' +
            '<form id="maintForm" class="card"><div class="form-inline">' +
            '<div class="form-group"><label>Vehicle</label><select name="vehicle_id" required><option value="">Select</option>' + avail.map(function(v) { return '<option value="' + v.id + '">' + v.name + '</option>'; }).join('') + '</select></div>' +
            '<div class="form-group"><label>Description</label><input name="desc" placeholder="e.g. Oil Change" required></div>' +
            '<div class="form-group"><label>Cost ($)</label><input name="cost" type="number"></div>' +
            '<button type="submit" class="btn-sm">Add Service</button></div></form>' +
            '<div class="card"><table><thead><tr><th>Vehicle</th><th>Description</th><th>Cost</th><th>Date</th><th>Status</th></tr></thead><tbody id="maintTbody"></tbody></table></div>';
          document.getElementById('maintForm').onsubmit = function(e) {
            e.preventDefault();
            var d = this;
            var vehicles = load('vehicles');
            var logs = load('maintenance');
            var v = vehicles.find(function(x) { return x.id === parseInt(d.vehicle_id.value, 10); });
            if (!v) return;
            logs.push({ id: nextId(logs), vehicle_id: v.id, vehicle_name: v.name, description: d.desc.value, cost: parseFloat(d.cost.value) || 0, performed_at: new Date().toISOString() });
            v.status = 'in_shop';
            save('maintenance', logs); save('vehicles', vehicles);
            this.reset();
            renderMain('maintenance');
          };
          var tbody = document.getElementById('maintTbody');
          maintenanceLogs.forEach(function(m) {
            var status = m.completed_at ? '<span class="pill pill-completed">Completed</span>' : '<button type="button" class="btn-sm" data-id="' + m.id + '">Complete</button>';
            tbody.innerHTML += '<tr><td>' + m.vehicle_name + '</td><td>' + m.description + '</td><td>$' + m.cost + '</td><td>' + new Date(m.performed_at).toLocaleDateString() + '</td><td>' + status + '</td></tr>';
          });
          tbody.querySelectorAll('button').forEach(function(btn) {
            var mid = parseInt(btn.dataset.id, 10);
            btn.onclick = function() {
              var vehicles = load('vehicles');
              var logs = load('maintenance');
              var m = logs.find(function(x) { return x.id === mid; });
              if (m) {
                var v = vehicles.find(function(x) { return x.id === m.vehicle_id; });
                if (v) v.status = 'available';
                m.completed_at = new Date().toISOString();
                save('maintenance', logs); save('vehicles', vehicles);
                renderMain('maintenance');
              }
            };
          });
        } else if (page === 'fuel') {
          var vehicles = load('vehicles');
          var fuelLogs = load('fuel');
          main.innerHTML = '<h2 style="margin-bottom:0.25rem">Fuel & Expense Logging</h2><p style="color:#94a3b8;margin-bottom:1rem">Total Operational Cost = Fuel + Maintenance per Vehicle</p>' +
            '<form id="fuelForm" class="card"><div class="form-inline">' +
            '<div class="form-group"><label>Vehicle</label><select name="vehicle_id" required><option value="">Select</option>' + vehicles.map(function(v) { return '<option value="' + v.id + '">' + v.name + '</option>'; }).join('') + '</select></div>' +
            '<div class="form-group"><label>Liters</label><input name="liters" type="number" required></div>' +
            '<div class="form-group"><label>Cost ($)</label><input name="cost" type="number" required></div>' +
            '<div class="form-group"><label>Date</label><input name="date" type="date" required></div>' +
            '<button type="submit" class="btn-sm">Add Fuel Log</button></div></form>' +
            '<div class="card"><table><thead><tr><th>Vehicle</th><th>Liters</th><th>Cost</th><th>Date</th></tr></thead><tbody id="fuelTbody"></tbody></table></div>';
          var today = new Date().toISOString().slice(0, 10);
          document.querySelector('#fuelForm input[name=date]').value = today;
          document.getElementById('fuelForm').onsubmit = function(e) {
            e.preventDefault();
            var d = this;
            var vehicles = load('vehicles');
            var logs = load('fuel');
            var v = vehicles.find(function(x) { return x.id === parseInt(d.vehicle_id.value, 10); });
            logs.push({ id: nextId(logs), vehicle_id: v ? v.id : null, vehicle_name: v ? v.name : '', liters: parseFloat(d.liters.value), cost: parseFloat(d.cost.value), date: d.date.value });
            save('fuel', logs);
            this.reset();
            document.querySelector('#fuelForm input[name=date]').value = new Date().toISOString().slice(0, 10);
            renderMain('fuel');
          };
          var tbody = document.getElementById('fuelTbody');
          fuelLogs.forEach(function(f) {
            tbody.innerHTML += '<tr><td>' + (f.vehicle_name || f.vehicle_id || '-') + '</td><td>' + f.liters + ' L</td><td>$' + f.cost + '</td><td>' + f.date + '</td></tr>';
          });
        }
      }

      function renderApp() {
        var root = document.getElementById('root');
        root.innerHTML = '<div class="app">' +
          '<aside class="sidebar">' +
          '<div style="margin-bottom:1rem;font-weight:700;color:#38bdf8">Fleet Hub</div>' +
          '<a href="#" class="nav-link active" data-page="dashboard">Command Center</a>' +
          '<a href="#" class="nav-link" data-page="vehicles">Vehicle Registry</a>' +
          '<a href="#" class="nav-link" data-page="trips">Trip Dispatcher</a>' +
          '<a href="#" class="nav-link" data-page="maintenance">Maintenance</a>' +
          '<a href="#" class="nav-link" data-page="fuel">Fuel & Expenses</a>' +
          '<a href="#" class="nav-link" data-page="drivers">Driver Profiles</a>' +
          '<div style="margin-top:auto;padding-top:1rem;border-top:1px solid #334155"><button type="button" id="logoutBtn" style="background:transparent;color:#64748b;width:100%;text-align:left;cursor:pointer;border:none;padding:0.5rem">Logout</button></div>' +
          '</aside>' +
          '<main id="main" class="main"></main>' +
          '</div>';
        root.querySelectorAll('.nav-link').forEach(function(a) {
          a.onclick = function(e) { e.preventDefault(); root.querySelectorAll('.nav-link').forEach(function(x) { x.classList.remove('active'); }); this.classList.add('active'); renderMain(this.dataset.page); };
        });
        document.getElementById('logoutBtn').onclick = function() {
          localStorage.removeItem(STORAGE.user);
          renderLogin();
        };
        renderMain('dashboard');
      }

      if (!localStorage.getItem(STORAGE.user)) {
        renderLogin();
      } else {
        renderApp();
      }
    })();
  </script>
</body>
</html>


